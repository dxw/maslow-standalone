
<%= f.action  :submit,
              :button_html => {
                :value => "Save",
                :class => "btn btn-default btn-primary hide"
              } %>

<%= f.inputs "Acceptance criteria", :id => "acceptance" do %>
  <div class="string input optional stringish form-group">
    <div class="form-label">
      <label class="control-label" for="met-when-criteria">Need is likely to be met when the user...</label>
    </div>
    <p class="text-muted">How will you know when this need has been met? <span class="optional">(optional)</span></p>
    <div
      id="met-when-criteria"
      <% if params[:delete_criteria].present? || params[:criteria_action].present? %>
      data-module="scroll-to-element"
      <% end %>
    >
      <% met_when_criteria.each_with_index do |c, i| %>
        <div class="row">
          <div class="add-bottom-margin col-md-8">
            <% if met_when_criteria.length > 1 %>
              <div class="input-group">
                <%= text_field_tag("need[met_when][]", c, :id => "criteria-#{i}", :class => "form-control") %>
                <span class="input-group-btn">
                  <%= button_tag(
                        :name => "delete_criteria",
                        :id => "delete-criteria",
                        :class => "btn btn-default",
                        :value => i) do %>
                    <span class="glyphicon glyphicon-remove" title="Remove criteria"></span>
                  <% end %>
                </span>
              </div>
            <% else %>
              <%= text_field_tag("need[met_when][]", c, :id => "criteria-#{i}", :class => "form-control") %>
            <% end %>
          </div>
        </div>
      <% end %>
      <%= f.submit "Enter another criteria", :id=> "criteria_action", :name => "criteria_action", :class => "btn btn-default add-label-margin" %>
    </div>
  </div>
<% end %>

<script>
  $(document).ready(function() {
    $('#met-when-criteria .form-control').keypress(function(e) {
      if (e.which == 13) {
        $('#criteria_action')[0].click();
        e.preventDefault();
      };
    });

    <% if params[:criteria_action].present? %>
      // Select last form field
      $('#met-when-criteria .form-control:last')[0].focus();
    <% end %>
  });
</script>
